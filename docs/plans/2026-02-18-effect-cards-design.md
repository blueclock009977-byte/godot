# 効果カード設計ドキュメント

## 基礎予算式
- `Budget = 12 + 8 * cost`
- ドロー: 1枚あたり -12

## 設計原則
- 効果テキストは effect_manager.gd に一元管理
- 効果量は card_database.gd の modifier で調整
- 全効果IDをカバー

## 調整記録

### 2026-02-20 チェーン式検証開始
- v1.1.46時点: 基礎予算12+8cost、過剰効果弱体化済み
- オンライン対戦: v1.1.43でスロット同期・ターン重複処理修正済み

### 2026-02-20 16:07 シミュレーター実行 (Phase 3)
**テスト結果:** 482テスト全パス

**色別勝率（100ゲーム×21マッチアップ）:**
| 色 | 勝率 | 勝/試合 |
|---|---:|---:|
| BLUE | 6.8% | 81/1200 |
| GREEN | 8.8% | 105/1200 |
| BLACK | 12.2% | 146/1200 |
| RED | 6.3% | 76/1200 |
| YELLOW | 6.6% | 79/1200 |
| PURPLE | 7.0% | 84/1200 |
| WHITE | 6.7% | 80/1200 |

**バランス指標:**
- 色勝率差: 5.8% ✓（目標15%以内）
- 先攻有利: +11.8% ✗（目標8%以内）
- 平均ターン: 44-49

**問題発見:**
1. 勝率が6-12%と異常に低い → ほぼ全ゲームがドローで終了
2. 平均ターンが50近い → 上限到達でドロー判定
3. シミュレーターのダメージ処理に問題がある可能性

**次のアクション:**
- シミュレーターのバトルロジックを検証・修正
- ダメージがプレイヤーHPに正しく反映されているか確認

### 2026-02-20 16:15 シミュレーター修正 (Phase 3.1)
**修正内容:**
1. `duplicate(true)` を削除 → カードHPがバトル後に反映されるように
2. カードへの攻撃時のプレイヤーHP加算を削除 → 直接攻撃のみプレイヤーHPに反映

**修正後の結果:**
| 色 | 勝率 |
|---|---:|
| BLUE | 7.6% |
| GREEN | 5.5% |
| BLACK | 13.0% |
| RED | 5.8% |
| YELLOW | 7.2% |
| PURPLE | 7.6% |
| WHITE | 7.3% |

- 色勝率差: 7.5% ✓
- 先攻有利: +11.2% ✗

**残存問題:**
- 勝率5-13%と低すぎ = ドローが多発
- 平均ターン44-49 = 50ターン上限で決着なし
- シミュレーターのターン進行orマナ計算に問題がある可能性

### 2026-02-20 16:15 シミュレーター修正完了 (Phase 4)

**根本原因特定:**
`_simulate_game`内で参照変数（cur_hand, cur_mana）を使用していたが、ターン交代後に条件判定していたため、値の更新が逆転していた。

**修正内容:**
- 参照変数方式を廃止
- 各プレイヤーの手札/マナ/フィールドを直接操作に変更
- ターン判定で分岐して処理

**修正後の結果:**
| 色 | 勝率 | 勝/試合 |
|---|---:|---:|
| BLUE | 47.2% | 566/1200 |
| GREEN | 55.5% | 666/1200 |
| **BLACK** | **71.2%** | 854/1200 |
| RED | 48.0% | 576/1200 |
| YELLOW | 44.0% | 528/1200 |
| PURPLE | 44.2% | 531/1200 |
| **WHITE** | **37.0%** | 444/1200 |

**バランス指標:**
- 色勝率差: 34.2% ✗（目標15%以内）
- 先攻有利: +11.3% ✗（目標8%以内）
- **平均ターン: 20-24 ✓**（正常範囲）

**分析:**
- シミュレーターは正常動作！ゲームが適切に終了するようになった
- **BLACK（黒）が圧倒的に強い** - 71.2%勝率
- **WHITE（白）が弱い** - 37.0%勝率
- 先攻有利が高めなのはゲーム性として許容範囲か要検討

**次のアクション:**
1. 黒カードのステータス確認・弱体化
2. 白カードのステータス確認・強化
3. 再シミュレーションで収束確認

---
*このドキュメントは調整ごとに追記*
