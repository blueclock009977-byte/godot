# ギルドアドベンチャー 設計書 v2

## コンセプト
**超多彩なビルド構築 × 放置系探索RPG**

冒険者ギルド物語2にインスパイアされた、Next.js + Reactで作るWebゲーム。

---

## ビルドシステム

### 4要素（各3項目 = 81通りの組み合わせ）

#### 種族（Race）
キャラの基礎ステータスに影響

| 種族 | HP | ATK | DEF | AGI | MAG | 特徴 |
|------|-----|-----|-----|-----|-----|------|
| 人間 | 100 | 10 | 10 | 10 | 10 | バランス型、経験値ボーナス |
| エルフ | 80 | 8 | 6 | 15 | 14 | 高AGI/MAG、魔法向き |
| ドワーフ | 130 | 14 | 16 | 5 | 4 | 高HP/DEF、壁役 |

#### 職業（Job）
行動パターンとスキルに影響

| 職業 | 役割 | スキル | 補正 |
|------|------|--------|------|
| 戦士 | 物理アタッカー | 強撃（ATK×1.5、単体） | ATK+20% |
| 魔法使い | 魔法アタッカー | ファイア（MAG×1.2、全体） | MAG+30%, DEF-10% |
| 僧侶 | ヒーラー | ヒール（味方1体HP回復） | DEF+10%, MAG+10% |

#### 個性（Trait）
パッシブ効果

| 個性 | 効果 |
|------|------|
| 勇敢 | 先制攻撃率+30%、与ダメ+5% |
| 慎重 | 被ダメージ-15%、回避+10% |
| 幸運 | クリティカル率+20%、ドロップ率UP |

#### 環境（Environment）
特定ダンジョンでのボーナス

| 環境 | 相性ダンジョン | 効果 |
|------|---------------|------|
| 草原育ち | 草原 | 全ステ+15%、回避+10% |
| 森林育ち | 森林 | ATK+20%、先制率+20% |
| 海育ち | 海 | MAG+25%、HP+10% |

※洞窟はどの環境でもボーナスなし（高難度）

---

## バトルシステム（冒険者ギルド物語2参考）

### 概要
- **オートバトル**（ログ形式）
- プレイヤーは編成のみ、戦闘は自動
- 結果はテキストログで表示

### ステータス
```
HP  - 体力（0になると戦闘不能）
ATK - 攻撃力（物理ダメージ計算に使用）
DEF - 防御力（被ダメージ軽減）
AGI - 素早さ（行動順、回避に影響）
MAG - 魔力（魔法ダメージ、回復量に影響）
```

### 行動順（冒険者ギルド物語2準拠）
1. 全キャラのAGIを比較
2. AGI高い順に行動
3. 同値の場合: `AGI + random(0-10)` で決定

### ダメージ計算（冒険者ギルド物語2準拠）

#### 物理ダメージ
```javascript
// 乱数: 0.85 ~ 1.15
const randomA = 0.85 + Math.random() * 0.3;
const randomB = 0.85 + Math.random() * 0.3;

// 基本ダメージ
let damage = (ATK * randomA) - (DEF * randomB * 0.5);

// 最低ダメージ保証
damage = Math.max(1, damage);

// クリティカル判定（1.5倍）
if (Math.random() < critRate) {
  damage *= 1.5;
}

// 隊列補正
damage *= positionModifier; // 前衛1.1, 後衛0.9
```

#### 魔法ダメージ
```javascript
// 魔法は防御力の影響を受けにくい
let damage = MAG * skillMultiplier * (0.9 + Math.random() * 0.2);
damage = damage - (DEF * 0.2);
damage = Math.max(1, damage);
```

#### 回復量
```javascript
const heal = MAG * 0.8 * (0.9 + Math.random() * 0.2);
```

### 戦闘フロー
```
1. 遭遇フェーズ
   - 敵パーティ生成（ダンジョンに応じたモンスター）
   - 先制判定（AGI比較 + 個性ボーナス）
   
2. バトルフェーズ（ループ）
   a. 行動順決定（AGI + 乱数）
   b. 各キャラ行動:
      - 戦士: 通常攻撃 or 強撃（HP>50%時）
      - 魔法使い: ファイア（敵2体以上） or 通常攻撃
      - 僧侶: ヒール（味方HP<50%） or 通常攻撃
   c. ダメージ適用
   d. 戦闘不能チェック
   e. 勝敗判定
   
3. 結果フェーズ
   - 勝利: 次の遭遇 or ダンジョンクリア
   - 敗北: 探索終了
```

### 隊列システム
- **前衛**（3人）: 被ダメ+10%, 与ダメ+10%, 狙われやすい
- **後衛**（3人）: 被ダメ-10%, 与ダメ-10%, 狙われにくい
- 前衛が全滅すると後衛が前に出る

---

## ダンジョンシステム

### ダンジョン一覧
| ダンジョン | 遠征時間 | 難易度 | 遭遇数 | 特徴 |
|-----------|----------|--------|--------|------|
| 草原 | 30秒 | ★☆☆☆ | 3 | 入門向け |
| 森林 | 10分 | ★★☆☆ | 5 | バランス型 |
| 海 | 1時間 | ★★★☆ | 10 | 魔法が有効 |
| 洞窟 | 2時間 | ★★★★ | 15 | 最高難度 |

### モンスター

#### 草原（★）
| 名前 | HP | ATK | DEF | AGI | 特徴 |
|------|-----|-----|-----|-----|------|
| スライム | 30 | 5 | 2 | 5 | 弱い |
| ゴブリン | 40 | 8 | 3 | 8 | 素早い |
| 野犬 | 35 | 10 | 2 | 12 | 先制攻撃 |

#### 森林（★★）
| 名前 | HP | ATK | DEF | AGI | 特徴 |
|------|-----|-----|-----|-----|------|
| オーク | 80 | 15 | 8 | 6 | 高火力 |
| ウルフ | 50 | 12 | 4 | 15 | 高AGI |
| トレント | 100 | 8 | 15 | 3 | 硬い |

#### 海（★★★）
| 名前 | HP | ATK | DEF | AGI | MAG | 特徴 |
|------|-----|-----|-----|-----|-----|------|
| マーマン | 100 | 20 | 12 | 10 | 15 | バランス |
| クラーケン | 200 | 30 | 15 | 5 | 0 | 物理型 |
| セイレーン | 80 | 10 | 8 | 12 | 25 | 魔法攻撃 |

#### 洞窟（★★★★）
| 名前 | HP | ATK | DEF | AGI | MAG | 特徴 |
|------|-----|-----|-----|-----|-----|------|
| ゴーレム | 300 | 25 | 30 | 3 | 0 | 超硬い |
| ドラゴン | 500 | 50 | 20 | 12 | 30 | ボス級 |
| リッチ | 150 | 15 | 10 | 8 | 40 | 高魔力 |

---

## 画面構成

### 1. ホーム画面
```
┌─────────────────────────────┐
│      ギルドアドベンチャー      │
│                             │
│    [キャラ作成]              │
│    [パーティ編成]            │
│    [冒険に出る]              │
│                             │
│    キャラ数: 3/20            │
└─────────────────────────────┘
```

### 2. キャラ作成画面
```
┌─────────────────────────────┐
│      キャラクター作成         │
├─────────────────────────────┤
│ 名前: [________]             │
│                             │
│ 種族: ○人間 ○エルフ ○ドワーフ │
│ 職業: ○戦士 ○魔法使い ○僧侶  │
│ 個性: ○勇敢 ○慎重 ○幸運     │
│ 環境: ○草原 ○森林 ○海       │
├─────────────────────────────┤
│ 【ステータスプレビュー】      │
│ HP:100 ATK:12 DEF:10        │
│ AGI:10 MAG:10               │
├─────────────────────────────┤
│         [作成する]           │
└─────────────────────────────┘
```

### 3. パーティ編成画面
```
┌─────────────────────────────┐
│      パーティ編成            │
├─────────────────────────────┤
│ 【前衛】                     │
│ [キャラ1] [キャラ2] [空き]    │
│                             │
│ 【後衛】                     │
│ [空き] [空き] [空き]         │
├─────────────────────────────┤
│ 【待機中のキャラ】           │
│ [キャラ3] [キャラ4] ...      │
├─────────────────────────────┤
│         [編成完了]           │
└─────────────────────────────┘
```

### 4. ダンジョン選択画面
```
┌─────────────────────────────┐
│      冒険先を選択            │
├───────┬───────┬──────┬──────┤
│ 草原  │ 森林  │  海  │ 洞窟 │
│ ★☆☆☆ │ ★★☆☆ │ ★★★☆ │ ★★★★ │
│ 30秒  │ 10分  │ 1時間│ 2時間│
│[出発] │[出発] │[出発]│[出発]│
└───────┴───────┴──────┴──────┘
```

### 5. 冒険中画面
```
┌─────────────────────────────┐
│      草原を探索中...         │
├─────────────────────────────┤
│ [██████████░░░░░░░░░░] 50%   │
│ 残り時間: 15秒               │
├─────────────────────────────┤
│ 【戦闘ログ】                 │
│ > スライムが現れた！          │
│ > 戦士の攻撃！12ダメージ！    │
│ > スライムを倒した！          │
│ > ゴブリンが現れた！          │
│ > ...                       │
├─────────────────────────────┤
│        [中断する]            │
└─────────────────────────────┘
```

### 6. 結果画面
```
┌─────────────────────────────┐
│       探索完了！             │
├─────────────────────────────┤
│ 結果: 勝利！                 │
│ 遭遇数: 3                    │
│ 倒した敵: 5体                │
├─────────────────────────────┤
│ 【詳細ログ】                 │
│ (スクロール可能な戦闘ログ)    │
├─────────────────────────────┤
│        [ホームに戻る]        │
└─────────────────────────────┘
```

---

## 技術スタック

### フロントエンド
- **Next.js 14** (App Router)
- **React 18**
- **TypeScript**
- **Tailwind CSS**
- **Zustand** (状態管理)
- **Framer Motion** (アニメーション)

### デプロイ
- **Vercel**

---

## ファイル構成
```
guild-adventure/
├── src/
│   ├── app/
│   │   ├── page.tsx              # ホーム
│   │   ├── layout.tsx            # レイアウト
│   │   ├── create/
│   │   │   └── page.tsx          # キャラ作成
│   │   ├── party/
│   │   │   └── page.tsx          # パーティ編成
│   │   ├── dungeon/
│   │   │   └── page.tsx          # ダンジョン選択
│   │   └── adventure/
│   │       └── page.tsx          # 冒険中
│   ├── components/
│   │   ├── CharacterCard.tsx
│   │   ├── PartySlot.tsx
│   │   ├── DungeonCard.tsx
│   │   ├── BattleLog.tsx
│   │   └── ProgressBar.tsx
│   ├── lib/
│   │   ├── types.ts              # 型定義
│   │   ├── data/
│   │   │   ├── races.ts          # 種族データ
│   │   │   ├── jobs.ts           # 職業データ
│   │   │   ├── traits.ts         # 個性データ
│   │   │   ├── environments.ts   # 環境データ
│   │   │   ├── dungeons.ts       # ダンジョンデータ
│   │   │   └── monsters.ts       # モンスターデータ
│   │   └── battle/
│   │       ├── engine.ts         # バトルエンジン
│   │       ├── damage.ts         # ダメージ計算
│   │       └── ai.ts             # 行動AI
│   └── store/
│       └── gameStore.ts          # Zustand store
├── docs/
│   └── DESIGN.md
├── public/
├── tailwind.config.ts
├── tsconfig.json
└── package.json
```

---

## 実装フェーズ

### Phase 1: 基盤 ✅
- [x] 設計書作成

### Phase 2: プロジェクトセットアップ
- [ ] Next.js初期化
- [ ] Tailwind設定
- [ ] 型定義作成
- [ ] マスターデータ作成

### Phase 3: UI実装
- [ ] ホーム画面
- [ ] キャラ作成画面
- [ ] パーティ編成画面
- [ ] ダンジョン選択画面

### Phase 4: バトルシステム
- [ ] バトルエンジン
- [ ] ダメージ計算
- [ ] 行動AI
- [ ] 戦闘ログ生成

### Phase 5: 冒険システム
- [ ] 遠征タイマー
- [ ] 冒険中画面
- [ ] 結果画面

### Phase 6: 仕上げ
- [ ] アニメーション追加
- [ ] レスポンシブ対応
- [ ] Vercelデプロイ
