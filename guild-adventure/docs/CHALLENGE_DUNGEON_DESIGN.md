# チャレンジダンジョン 企画書

## コンセプト
**「どこまで進めるか？」** - 100階層のダンジョンを攻略し、到達階層を競う

---

## 基本仕様

### アクセス
- **ホーム画面** の「ソロ冒険」と「キャラ作成」の間に配置
- ボタン名: 「⚔️ チャレンジダンジョン」

### 挑戦ルール
| 項目 | 仕様 |
|------|------|
| 挑戦回数 | **8時間に1回** |
| 結果表示 | **即時**（ボタン押下→即計算→結果表示） |
| 階層数 | **1〜100階層** |
| パーティ | **専用編成**（ソロとは別保存、画面内で編成可能） |
| HP/MP | 各階層で**全回復** |
| 100Fクリア後 | **何度でも挑戦可能**（報酬も毎回もらえる） |
| 挑戦履歴 | **最新10件**保存 |

### 挑戦フロー
```
「⚔️ 挑戦する」ボタン押下
    ↓
1F〜敗北するまで自動でバトル計算（即時）
    ↓
結果画面表示（到達階層、獲得報酬）
    ↓
挑戦ログに記録
    ↓
8時間クールダウン開始
```
※途中離脱・中断という概念なし。押したら最後まで自動計算。

### ドロップ仕様
- **到達階層に応じた固定報酬**
- ドロップボーナス、コインボーナス等は**無効**
- 運要素を排除し、実力で報酬が決まる

---

## 階層設計

### 10Fサイクル × 10段階

**基本構造:** 1Fごとにコンセプトがローテーション、10Fごとに敵が強くなる

| 末尾 | コンセプト | 敵数 | 特徴 | 有効な編成 |
|------|-----------|------|------|-----------|
| 1F | バランス型 | 2体 | 特殊耐性なし | 何でもOK |
| 2F | 物理耐性 | 1体 | 物理ダメージ軽減 | 魔法職 |
| 3F | 魔法耐性 | 1体 | 魔法ダメージ軽減 | 物理職 |
| 4F | 高AGI・回避 | 3体 | 攻撃が当たりにくい | 命中UP・必中スキル |
| 5F | 高火力 | 2体 | 高ATK、先制攻撃 | 高耐久・回復 |
| 6F | デバフ型 | 4体 | 状態異常攻撃 | 状態耐性 |
| 7F | 再生型 | 1体 | 毎ターンHP回復 | 高火力で押し切る |
| 8F | 複合耐性 | 2体 | 物理+魔法両方軽減 | 属性攻撃・貫通 |
| 9F | 高HP壁 | 1体 | 超耐久、低火力 | 継続火力 |
| 10F | **ボス** | 1体 | 複合能力、高ステ | 総合力 |

**敵データ:** 既存ダンジョンの敵を流用 or 新規作成、コンセプトに合っていればOK

### 難易度カーブ

**到達目安（通常ダンジョンクリア相当）:**
| 階層 | 難易度目安 |
|------|-----------|
| 3F | 草原クリア相当 |
| 10F | 森クリア相当 |
| 25F | 洞窟クリア相当 |
| 40F | 海クリア相当 |
| 50F | 砂漠クリア相当 |
| 60F | 火山クリア相当 |
| 70F | 雪原クリア相当 |
| 80F | 神殿クリア相当 |
| 90F | 神殿+フル装備 |
| 100F | 最高難度（理論上の限界） |

**段階別ステータス倍率:**
| 段階 | 階層 | ステータス倍率 |
|------|------|---------------|
| 1 | 1-10F | ×1.0 |
| 2 | 11-20F | ×1.5 |
| 3 | 21-30F | ×2.2 |
| 4 | 31-40F | ×3.0 |
| 5 | 41-50F | ×3.8 |
| 6 | 51-60F | ×4.6 |
| 7 | 61-70F | ×5.4 |
| 8 | 71-80F | ×6.2 |
| 9 | 81-90F | ×7.5 |
| 10 | 91-100F | ×9.0 |

### 具体例

```
1F:  バランス型     →  草原の雑魚レベル
2F:  物理耐性       →  ゴーレム系
3F:  魔法耐性       →  ★草原クリア相当★
...
10F: ボス           →  ★森クリア相当★

11F: バランス型     →  森〜洞窟レベル
...
20F: ボス           →  洞窟手前

21F: バランス型     →  洞窟レベル
...
25F: 高火力         →  ★洞窟クリア相当★
...
30F: ボス           →  洞窟〜海レベル

31F: バランス型     →  海レベル
...
40F: ボス           →  ★海クリア相当★

...（以降も10Fごとにローテーション継続）...

80F: ボス           →  ★神殿クリア相当★
90F: ボス           →  神殿+フル装備必須
100F: 最終ボス      →  ダンジョンの支配者（理論上の限界）
```

---

## 報酬設計

### 報酬ルール（シンプル！）

| 条件 | 報酬 |
|------|------|
| **1Fクリアごと** | 3コイン |
| **5Fごと** | ランダム書×1（血統書 or 指南書、50%ずつ） |
| **20Fごと** | ランダム装備×1（レア判定は通常ロジック） |

※ドロップボーナス、コインボーナス等は**全て無効**（実力勝負）

### 報酬例

| 到達階層 | コイン | 書 | 装備 |
|---------|--------|-----|------|
| 10F | 30 | 2 | 0 |
| 20F | 60 | 4 | 1 |
| 30F | 90 | 6 | 1 |
| 40F | 120 | 8 | 2 |
| 50F | 150 | 10 | 2 |
| 60F | 180 | 12 | 3 |
| 70F | 210 | 14 | 3 |
| 80F | 240 | 16 | 4 |
| 90F | 270 | 18 | 4 |
| 100F | 300 | 20 | 5 |

※敗北した階層までの報酬を獲得（例: 25Fで敗北 → 24F分の報酬）

---

## ランキング

### ランキング仕様
- **到達階層**でソート（同階層の場合は先に到達した順）
- **リセットなし**（通算最高記録のみ）
- **報酬なし**（純粋な記録板）
- 表示: 上位100名
- 自分の順位は常に表示

---

## UI設計

### ホーム画面（ソロ冒険とキャラ作成の間）
```
┌─────────────────────────────┐
│ 🗺️ ソロ冒険                │
├─────────────────────────────┤
│ ⚔️ チャレンジダンジョン     │  ← NEW!
│   🟢 出撃可能！             │  ← or「あと 2:30:00」
│   最高到達: 45F             │
├─────────────────────────────┤
│ 👤 キャラ作成               │
└─────────────────────────────┘
```

### チャレンジダンジョン画面（/challenge）
```
┌─────────────────────────────────┐
│ ← 戻る    ⚔️ チャレンジダンジョン │
├─────────────────────────────────┤
│                                 │
│  📖 仕様説明                    │
│  ┌─────────────────────────┐    │
│  │ ・100階層を即時挑戦         │
│  │ ・8時間に1回挑戦可能        │
│  │ ・1Fごと3コイン            │
│  │ ・5Fごと書×1、20Fごと装備×1 │
│  └─────────────────────────┘    │
│                                 │
│  🛡️ パーティ編成               │
│  ┌─────────────────────────┐    │
│  │ [キャラ1] [キャラ2] [キャラ3]│
│  │ [キャラ4] [キャラ5] [キャラ6]│
│  │        📝 編成変更           │
│  └─────────────────────────┘    │
│                                 │
│  ⏰ 出撃可能！（or あと 2:30:00）│
│                                 │
│  ┌─────────────────────────┐    │
│  │      ⚔️ 挑戦する！         │
│  └─────────────────────────┘    │
│                                 │
│  📊 あなたの記録: 最高 45F      │
│                                 │
│  ┌──────────┐ ┌──────────┐     │
│  │🏆ランキング│ │📜挑戦履歴 │     │
│  └──────────┘ └──────────┘     │
│                                 │
└─────────────────────────────────┘
```

### ランキング画面
```
┌─────────────────────────────────┐
│ ← 戻る    🏆 ランキング          │
├─────────────────────────────────┤
│  1. Player1 - 100F 👑           │
│  2. Player2 - 95F               │
│  3. Player3 - 88F               │
│  ...                            │
│  45. あなた - 45F ←             │
│  ...                            │
└─────────────────────────────────┘
```

### 挑戦履歴画面
```
┌─────────────────────────────────┐
│ ← 戻る    📜 挑戦履歴            │
├─────────────────────────────────┤
│  3/1 14:00  到達 45F            │
│    💰135コイン 📜9冊 🎒2個       │
│  2/28 22:00 到達 38F            │
│    💰114コイン 📜7冊 🎒1個       │
│  ...                            │
└─────────────────────────────────┘
```
### 結果画面（挑戦後に表示）
```
┌─────────────────────────────────┐
│        ⚔️ 挑戦結果              │
├─────────────────────────────────┤
│                                 │
│      🏰 到達階層: 45F           │
│      （25Fで敗北）              │
│                                 │
│  ────────────────────────────   │
│  💰 獲得コイン: 132             │
│  📜 獲得した書: 8冊             │
│  🎒 獲得装備: 2個               │
│  ────────────────────────────   │
│                                 │
│  📋 詳細ログを見る              │
│                                 │
│  ┌─────────────────────────┐    │
│  │      🏠 ホームに戻る       │
│  └─────────────────────────┘    │
└─────────────────────────────────┘
```
- 敗北 or 撤退で終了、報酬獲得画面へ

---

## データ構造

```typescript
// Firebase: /guild-adventure/tower/{username}
interface TowerProgress {
  highestFloor: number;       // 最高到達階層
  lastAttemptTime: number;    // 最後の挑戦時刻
  currentRun?: {              // 現在の挑戦中（途中離脱対応）
    floor: number;
    startTime: number;
  };
}

// Firebase: /guild-adventure/towerRanking/weekly
interface TowerRankingEntry {
  username: string;
  floor: number;
  achievedAt: number;
}

// Firebase: /guild-adventure/towerRanking/allTime
// 同様の構造
```

---

## 実装タスク

### Phase 1: 基本機能
- [ ] ホーム画面にボタン追加
- [ ] /tower ページ作成
- [ ] 階層データ定義（敵構成）
- [ ] バトルロジック（既存流用）
- [ ] 8時間クールダウン
- [ ] 到達階層保存

### Phase 2: 報酬・ランキング
- [ ] 固定報酬システム
- [ ] 週間ランキング
- [ ] 通算記録

### Phase 3: 演出・調整
- [ ] 階層ごとの背景・演出
- [ ] バランス調整
- [ ] 称号システム

---

## 議論ポイント（全て解決済み）

1. ~~8時間クールダウンのリセットタイミング~~ → 挑戦ボタン押下時
2. ~~途中離脱の扱い~~ → なし（即時計算）
3. ~~100Fクリア後~~ → 完全クリア、周回要素なし
4. ~~書の種類~~ → ランダム（血統書 or 指南書）
5. ~~装備の種類~~ → ランダム（レア判定は通常ロジック）
6. ~~ボーナス系~~ → 全て無効

---

*作成: SHIGE Jr. / 2026-03-01*
*更新: パパの仕様に基づき改訂*
