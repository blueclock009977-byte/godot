# チャレンジダンジョン 企画書

## コンセプト
**「どこまで進めるか？」** - 100階層のダンジョンを攻略し、到達階層を競う

---

## 基本仕様

### アクセス
- **ホーム画面** の「ソロ冒険」と「キャラ作成」の間に配置
- ボタン名: 「⚔️ チャレンジダンジョン」

### 挑戦ルール
| 項目 | 仕様 |
|------|------|
| 挑戦回数 | **8時間に1回** |
| 結果表示 | **即時**（待ち時間なし） |
| 階層数 | **1〜100階層** |
| パーティ | ソロと同じ（最大6人） |
| HP/MP | 各階層で**全回復** |

### ドロップ仕様
- **到達階層に応じた固定報酬**
- ドロップボーナス、コインボーナス等は**無効**
- 運要素を排除し、実力で報酬が決まる

---

## 階層設計

### 難易度目安（通常ダンジョンとの対応）

| 階層 | 難易度目安 | コンセプト |
|------|-----------|-----------|
| 1-3 | 草原クリア相当 | チュートリアル |
| 4-10 | 森クリア相当 | バランス型 |
| 11-25 | 洞窟クリア相当 | 物理耐性の敵が増加 |
| 26-40 | 海クリア相当 | 魔法耐性の敵が増加 |
| 41-55 | 砂漠クリア相当 | 高AGI・回避型 |
| 56-70 | 火山クリア相当 | 高火力・速攻型 |
| 71-80 | 雪原クリア相当 | 状態異常・デバフ型 |
| 81-90 | 神殿クリア相当 | 複合耐性・ボス級 |
| 91-99 | 神殿+装備必須 | 超高難度 |
| 100 | 最終ボス | 伝説級の敵 |

### 階層コンセプト詳細

```
1-10F: 入門の間
  - バランス型の敵
  - 特殊な耐性なし
  - 誰でもクリア可能

11-25F: 鋼鉄の間
  - 物理耐性+30〜50%の敵
  - 魔法職が有利
  - ゴーレム系、甲殻系

26-40F: 神秘の間
  - 魔法耐性+30〜50%の敵
  - 物理職が有利
  - 精霊系、魔導士系

41-55F: 疾風の間
  - 高AGI、高回避の敵
  - 命中率が重要
  - 忍者系、風属性

56-70F: 灼熱の間
  - 高ATK、先制攻撃
  - 耐久力・回復が重要
  - 火属性、バーサーカー系

71-80F: 氷結の間
  - デバフ・状態異常攻撃
  - 状態耐性が重要
  - 氷属性、呪術師系

81-90F: 混沌の間
  - 物理+魔法両方に耐性
  - 弱点属性を突く必要
  - 複合型ボス

91-99F: 絶望の間
  - 全ステータスが極めて高い
  - Lv5+装備+最適編成必須
  - 1体でも強力

100F: ダンジョンの支配者
  - 最終ボス
  - 全属性耐性、超ステータス
  - クリアで称号獲得
```

---

## 報酬設計

### 到達階層報酬（固定）

| 到達階層 | コイン | アイテム |
|---------|--------|----------|
| 5F | 5 | - |
| 10F | 10 | ランダム血統書×1 |
| 15F | 15 | - |
| 20F | 20 | ランダム指南書×1 |
| 25F | 30 | - |
| 30F | 40 | ランダム血統書×1 |
| 40F | 60 | ランダム指南書×1 |
| 50F | 80 | レア装備確定×1 |
| 60F | 100 | ランダム血統書×1 |
| 70F | 120 | ランダム指南書×1 |
| 80F | 150 | レア装備確定×1 |
| 90F | 200 | 上位血統書×1（新種族） |
| 100F | 500 | 伝説装備×1 + 称号 |

※途中で敗北した場合、最後にクリアした階層までの報酬を獲得

---

## ランキング

### ランキング仕様
- **到達階層**でソート（同階層の場合は先に到達した順）
- 表示: 上位100名
- 自分の順位は常に表示

### ランキング種類
| 種類 | リセット | 報酬 |
|------|----------|------|
| 週間ランキング | 毎週月曜 | 順位に応じたコイン |
| 通算最高記録 | なし | 称号・実績 |

### 週間ランキング報酬
| 順位 | 報酬 |
|------|------|
| 1位 | 300コイン + 称号「チャレンジ覇者」 |
| 2-3位 | 200コイン |
| 4-10位 | 100コイン |
| 11-50位 | 50コイン |
| 51-100位 | 20コイン |

---

## UI設計

### ホーム画面
```
┌─────────────────────┐
│ 🗺️ ソロ冒険        │
├─────────────────────┤
│ ⚔️ チャレンジダンジョン         │  ← NEW!
│   最高到達: 45F     │
│   次回挑戦: 2:30:00 │
├─────────────────────┤
│ 👤 キャラ作成       │
└─────────────────────┘
```

### チャレンジダンジョン画面
```
┌─────────────────────────────────┐
│ ← 戻る    ⚔️ チャレンジダンジョン           │
├─────────────────────────────────┤
│                                 │
│  📊 あなたの記録                │
│  ┌─────────────────────────┐  │
│  │ 最高到達: 45F           │  │
│  │ 今回の階層: 1F スタート  │  │
│  └─────────────────────────┘  │
│                                 │
│  ⏰ 次回挑戦まで: 2:30:00      │
│                                 │
│  ┌─────────────────────────┐  │
│  │    ⚔️ 挑戦する          │  │
│  └─────────────────────────┘  │
│                                 │
│  🏆 ランキング                 │
│  ┌─────────────────────────┐  │
│  │ 1. Player1 - 100F       │  │
│  │ 2. Player2 - 95F        │  │
│  │ 3. Player3 - 88F        │  │
│  │ ...                     │  │
│  │ 45. あなた - 45F        │  │
│  └─────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### バトル画面
- 通常バトルと同じUI
- 上部に「現在: 15F」表示
- 勝利後「次の階層へ」ボタン
- 敗北 or 撤退で終了、報酬獲得画面へ

---

## データ構造

```typescript
// Firebase: /guild-adventure/tower/{username}
interface TowerProgress {
  highestFloor: number;       // 最高到達階層
  lastAttemptTime: number;    // 最後の挑戦時刻
  currentRun?: {              // 現在の挑戦中（途中離脱対応）
    floor: number;
    startTime: number;
  };
}

// Firebase: /guild-adventure/towerRanking/weekly
interface TowerRankingEntry {
  username: string;
  floor: number;
  achievedAt: number;
}

// Firebase: /guild-adventure/towerRanking/allTime
// 同様の構造
```

---

## 実装タスク

### Phase 1: 基本機能
- [ ] ホーム画面にボタン追加
- [ ] /tower ページ作成
- [ ] 階層データ定義（敵構成）
- [ ] バトルロジック（既存流用）
- [ ] 8時間クールダウン
- [ ] 到達階層保存

### Phase 2: 報酬・ランキング
- [ ] 固定報酬システム
- [ ] 週間ランキング
- [ ] 通算記録

### Phase 3: 演出・調整
- [ ] 階層ごとの背景・演出
- [ ] バランス調整
- [ ] 称号システム

---

## 議論ポイント

1. **8時間クールダウンのリセットタイミング**
   - 挑戦開始時？挑戦終了時？

2. **途中離脱の扱い**
   - アプリ閉じたら負け扱い？再開可能？

3. **100Fクリア後**
   - 周回要素は必要？報酬2倍とか？

---

*作成: SHIGE Jr. / 2026-03-01*
*更新: パパの仕様に基づき改訂*
