# チャレンジダンジョン 企画書

## コンセプト
**「どこまで進めるか？」** - 100階層のダンジョンを攻略し、到達階層を競う

---

## 基本仕様

### アクセス
- **ホーム画面** の「ソロ冒険」と「キャラ作成」の間に配置
- ボタン名: 「⚔️ チャレンジダンジョン」

### 挑戦ルール
| 項目 | 仕様 |
|------|------|
| 挑戦回数 | **8時間に1回** |
| 結果表示 | **即時**（待ち時間なし） |
| 階層数 | **1〜100階層** |
| パーティ | ソロと同じ（最大6人） |
| HP/MP | 各階層で**全回復** |

### ドロップ仕様
- **到達階層に応じた固定報酬**
- ドロップボーナス、コインボーナス等は**無効**
- 運要素を排除し、実力で報酬が決まる

---

## 階層設計

### 10Fサイクル × 10段階

**基本構造:** 1Fごとにコンセプトがローテーション、10Fごとに敵が強くなる

| 末尾 | コンセプト | 特徴 | 有効な編成 |
|------|-----------|------|-----------|
| 1F | バランス型 | 特殊耐性なし | 何でもOK |
| 2F | 物理耐性 | 物理ダメージ軽減 | 魔法職 |
| 3F | 魔法耐性 | 魔法ダメージ軽減 | 物理職 |
| 4F | 高AGI・回避 | 攻撃が当たりにくい | 命中UP・必中スキル |
| 5F | 高火力 | 高ATK、先制攻撃 | 高耐久・回復 |
| 6F | デバフ型 | 状態異常攻撃 | 状態耐性 |
| 7F | 再生型 | 毎ターンHP回復 | 高火力で押し切る |
| 8F | 複合耐性 | 物理+魔法両方軽減 | 属性攻撃・貫通 |
| 9F | 高HP壁 | 超耐久、低火力 | 継続火力 |
| 10F | **ボス** | 複合能力、高ステ | 総合力 |

### 難易度カーブ

**到達目安（通常ダンジョンクリア相当）:**
| 階層 | 難易度目安 |
|------|-----------|
| 3F | 草原クリア相当 |
| 10F | 森クリア相当 |
| 25F | 洞窟クリア相当 |
| 40F | 海クリア相当 |
| 50F | 砂漠クリア相当 |
| 60F | 火山クリア相当 |
| 70F | 雪原クリア相当 |
| 80F | 神殿クリア相当 |
| 90F | 神殿+フル装備 |
| 100F | 最高難度（理論上の限界） |

**段階別ステータス倍率:**
| 段階 | 階層 | ステータス倍率 |
|------|------|---------------|
| 1 | 1-10F | ×1.0 |
| 2 | 11-20F | ×1.5 |
| 3 | 21-30F | ×2.2 |
| 4 | 31-40F | ×3.0 |
| 5 | 41-50F | ×3.8 |
| 6 | 51-60F | ×4.6 |
| 7 | 61-70F | ×5.4 |
| 8 | 71-80F | ×6.2 |
| 9 | 81-90F | ×7.5 |
| 10 | 91-100F | ×9.0 |

### 具体例

```
1F:  バランス型     →  草原の雑魚レベル
2F:  物理耐性       →  ゴーレム系
3F:  魔法耐性       →  ★草原クリア相当★
...
10F: ボス           →  ★森クリア相当★

11F: バランス型     →  森〜洞窟レベル
...
20F: ボス           →  洞窟手前

21F: バランス型     →  洞窟レベル
...
25F: 高火力         →  ★洞窟クリア相当★
...
30F: ボス           →  洞窟〜海レベル

31F: バランス型     →  海レベル
...
40F: ボス           →  ★海クリア相当★

...（以降も10Fごとにローテーション継続）...

80F: ボス           →  ★神殿クリア相当★
90F: ボス           →  神殿+フル装備必須
100F: 最終ボス      →  ダンジョンの支配者（理論上の限界）
```

---

## 報酬設計

### 到達階層報酬（固定）

| 到達階層 | コイン | アイテム |
|---------|--------|----------|
| 5F | 5 | - |
| 10F | 10 | ランダム血統書×1 |
| 15F | 15 | - |
| 20F | 20 | ランダム指南書×1 |
| 25F | 30 | - |
| 30F | 40 | ランダム血統書×1 |
| 40F | 60 | ランダム指南書×1 |
| 50F | 80 | レア装備確定×1 |
| 60F | 100 | ランダム血統書×1 |
| 70F | 120 | ランダム指南書×1 |
| 80F | 150 | レア装備確定×1 |
| 90F | 200 | 上位血統書×1（新種族） |
| 100F | 500 | 伝説装備×1 + 称号 |

※途中で敗北した場合、最後にクリアした階層までの報酬を獲得

---

## ランキング

### ランキング仕様
- **到達階層**でソート（同階層の場合は先に到達した順）
- **リセットなし**（通算最高記録のみ）
- **報酬なし**（純粋な記録板）
- 表示: 上位100名
- 自分の順位は常に表示

---

## UI設計

### ホーム画面
```
┌─────────────────────┐
│ 🗺️ ソロ冒険        │
├─────────────────────┤
│ ⚔️ チャレンジダンジョン         │  ← NEW!
│   最高到達: 45F     │
│   次回挑戦: 2:30:00 │
├─────────────────────┤
│ 👤 キャラ作成       │
└─────────────────────┘
```

### チャレンジダンジョン画面
```
┌─────────────────────────────────┐
│ ← 戻る    ⚔️ チャレンジダンジョン           │
├─────────────────────────────────┤
│                                 │
│  📊 あなたの記録                │
│  ┌─────────────────────────┐  │
│  │ 最高到達: 45F           │  │
│  │ 今回の階層: 1F スタート  │  │
│  └─────────────────────────┘  │
│                                 │
│  ⏰ 次回挑戦まで: 2:30:00      │
│                                 │
│  ┌─────────────────────────┐  │
│  │    ⚔️ 挑戦する          │  │
│  └─────────────────────────┘  │
│                                 │
│  🏆 ランキング                 │
│  ┌─────────────────────────┐  │
│  │ 1. Player1 - 100F       │  │
│  │ 2. Player2 - 95F        │  │
│  │ 3. Player3 - 88F        │  │
│  │ ...                     │  │
│  │ 45. あなた - 45F        │  │
│  └─────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### バトル画面
- 通常バトルと同じUI
- 上部に「現在: 15F」表示
- 勝利後「次の階層へ」ボタン
- 敗北 or 撤退で終了、報酬獲得画面へ

---

## データ構造

```typescript
// Firebase: /guild-adventure/tower/{username}
interface TowerProgress {
  highestFloor: number;       // 最高到達階層
  lastAttemptTime: number;    // 最後の挑戦時刻
  currentRun?: {              // 現在の挑戦中（途中離脱対応）
    floor: number;
    startTime: number;
  };
}

// Firebase: /guild-adventure/towerRanking/weekly
interface TowerRankingEntry {
  username: string;
  floor: number;
  achievedAt: number;
}

// Firebase: /guild-adventure/towerRanking/allTime
// 同様の構造
```

---

## 実装タスク

### Phase 1: 基本機能
- [ ] ホーム画面にボタン追加
- [ ] /tower ページ作成
- [ ] 階層データ定義（敵構成）
- [ ] バトルロジック（既存流用）
- [ ] 8時間クールダウン
- [ ] 到達階層保存

### Phase 2: 報酬・ランキング
- [ ] 固定報酬システム
- [ ] 週間ランキング
- [ ] 通算記録

### Phase 3: 演出・調整
- [ ] 階層ごとの背景・演出
- [ ] バランス調整
- [ ] 称号システム

---

## 議論ポイント

1. **8時間クールダウンのリセットタイミング**
   - 挑戦開始時？挑戦終了時？

2. **途中離脱の扱い**
   - アプリ閉じたら負け扱い？再開可能？

3. **100Fクリア後**
   - 周回要素は必要？報酬2倍とか？

---

*作成: SHIGE Jr. / 2026-03-01*
*更新: パパの仕様に基づき改訂*
