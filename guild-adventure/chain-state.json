{
  "taskId": "ga-refactor-2026-02-27",
  "goal": "Guild Adventureのソロ/マルチ処理を共通化・リファクタリング",
  "completionCriteria": [
    "重複コードが統合されている",
    "TypeScriptエラーがない",
    "chain-state.jsonのlogに変更履歴がある"
  ],
  "judgmentCriteria": [
    "1. 既存機能が壊れない",
    "2. コードの可読性向上",
    "3. 変更量は最小限",
    "4. ソロ/マルチで仕様が異なる場合は相談"
  ],
  "constraints": [
    "1cronで1タスクのみ",
    "ソロ/マルチで仕様が異なる場合はパパに相談"
  ],
  "currentPhase": 2,
  "phaseAttempt": 4,
  "maxAttempts": 30,
  "startedAt": "2026-02-27T04:44:00Z",
  "discordChannel": "channel:1471429991005950013",
  "assumptions": [],
  "log": [
    {
      "time": "2026-02-27T04:46:00Z",
      "action": "refactor",
      "file": "src/app/friends/page.tsx",
      "detail": "getDungeonName()とcalculateRemainingMinutes()ヘルパー関数を抽出、getStatusDisplay内の重複コードを削減"
    },
    {
      "time": "2026-02-27T04:49:00Z",
      "action": "refactor",
      "file": "src/lib/utils/status.ts",
      "detail": "getStatusDisplay()を共通ヘルパーに抽出。friends/page.tsxとmulti/[code]/page.tsxの重複を解消"
    },
    {
      "time": "2026-02-27T04:54:00Z",
      "action": "refactor",
      "file": "src/components/multi/InviteModal.tsx",
      "detail": "フレンド招待モーダルを別コンポーネントに抽出。multi/[code]/page.tsx: 791行→715行（-76行）"
    },
    {
      "time": "2026-02-27T05:01:00Z",
      "action": "refactor",
      "file": "src/components/multi/BattleResultView.tsx",
      "detail": "結果画面UIを別コンポーネントに抽出。multi/[code]/page.tsx: 715行→675行（-40行）"
    }
  ],
  "findings": [
    "multi/[code]/page.tsx がまだ675行 → 更に分割可能（バトル進行UI）",
    "restoreAdventure のソロ/マルチ処理が類似構造"
  ],
  "completed": [
    "friends/page.tsx: getDungeonName, calculateRemainingMinutes ヘルパー抽出",
    "lib/utils/status.ts: getStatusDisplay共通化（friends + multi両方で使用）",
    "components/multi/InviteModal.tsx: フレンド招待モーダルを抽出",
    "components/multi/BattleResultView.tsx: 結果画面UIを抽出"
  ]
}
